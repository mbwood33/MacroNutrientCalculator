@page "/profile"

@inject NavigationManager Navigation    /* For navigation if needed */
@inject MacroNutrientCalc.Services.DatabaseService dbService    /* Handles database operations */
@inject MacroNutrientCalc.Services.UserSessionServices userSessionService   /* Provides the logged-in user's ID */
@using MacroNutrientCalc.Models
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Calendars
@using Syncfusion.Blazor.Buttons

<div class="container mt-5">
    <h3>Edit Profile</h3>
    <EditForm Model="@userProfile" OnValidSubmit="HandleProfileUpdate">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label class="form-label">Email</label>
            <SfTextBox @bind-Value="userProfile.Email" Placeholder="Enter your email" CssClass="form-control" />
        </div>
        <div class="mb-3">
            <label class="form-label">Password</label>
            <SfTextBox @bind-Value="userProfile.Password" Placeholder="Enter your password" CssClass="form-control" Type="InputType.Password" />
        </div>
    </EditForm>
</div>


@code {
    // The model used for data-binding in the form
    private RegisterModel userProfile = new RegisterModel();
    private string message = string.Empty;

    // When the component initializes, load the user's data from the database
    protected override async Task OnInitializedAsync()
    {
        int userId = userSessionService.CurrentUserId;      // Retrieve hte current user's ID from the session service
        var userInfo = dbService.GetUserById(userId);       // Load user info from the database
        if (userInfo != null)
        {
            userProfile = userInfo;
        }
    }

    // Called when the user submits the form
    private void HandleProfileUpdate()
    {
        // Update the user's information in the database
        bool updated = dbService.UpdateUser(userProfile, userSessionService.CurrentUserId);
        message = updated ? "Profile updated successfully!" : "Error updating profile. Please try again.";
    }
}
